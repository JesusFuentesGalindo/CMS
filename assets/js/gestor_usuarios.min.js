var path_url=window.location.protocol+"//"+window.location.host;
$(document).ready(function(){$("#frm_add_user").submit(function(a){a.preventDefault();a.stopPropagation();if(!1===this.checkValidity())this.classList.add("was-validated");else{a=$("#frm_add_user #txt_username").val();let b=$("#frm_add_user #txt_email").val(),d=$("#frm_add_user #txt_contrasenia").val(),c={username:a,email:b,passwd:d};$.ajax({url:path_url+"/gestorUsuarios/crear_usuario",type:"POST",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:c,success:function(a){Swal.fire("Usuario Creado!",
"El usuario "+c.username+" ha sido creado!","success")},error:function(a){Swal.fire("Error!","El usuario "+c.username+" no puedo ser creado!","error");console.log(a)}})}});$(".btn_delete").on("click",function(){const a=Swal.mixin({customClass:{confirmButton:"btn btn-success",cancelButton:"btn btn-danger"},buttonsStyling:!1});a.fire({title:"Est\u00e1s seguro?",text:"No podr\u00e1s revertir esto!",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, eliminalo!",cancelButtonText:"No, cancela!",
reverseButtons:!0}).then(b=>{if(b.value){let a=$(this).attr("id");$.ajax({url:path_url+"/gestorUsuarios/eliminar_usuario",type:"POST",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:"user_id="+a,success:function(b){Swal.fire("Usuario Eliminado!","El usuario ha sido eliminado!","success");$("#"+a).parent().parent().remove()},error:function(a){Swal.fire("Error!","El usuario no puedo ser eliminado!","error");console.log(a)}})}else b.dismiss===Swal.DismissReason.cancel&&
a.fire("Cancelado","El usuario NO fue eliminado","error")})});$("#img_foto").on("change",function(){let a=this.files[0];if("image/jpeg"!=a.type&&"image/png"!=a.type)$(this).val(""),Swal.fire("Error!","La imagen debe ser jpeg o png!","error");else if(25E5<a.size)$(this).val(""),Swal.fire("Error!","La imagen no debe pesar m\u00e1s de 2 Megabytes!","error");else{let b=new FileReader;b.readAsDataURL(a);$(b).on("load",function(a){a=a.target.result;$("#img_previa").attr("src",a)})}});$("#frm_edit_user").submit(function(a){a.preventDefault();
a.stopPropagation();if(!1===this.checkValidity())this.classList.add("was-validated");else{let b=new FormData;a=document.getElementById("img_foto").files[0];let d=$("#frm_edit_user #edit_txt_username").val(),c=$("#frm_edit_user #edit_txt_email").val(),e=$("#frm_edit_user #edit_txt_contrasenia").val();b.append("username",d);b.append("email",c);b.append("passwd",e);b.append("photo",a);console.log(b);$.ajax({url:path_url+"/gestorUsuarios/actualizar_usuario",type:"POST",data:b,contentType:!1,processData:!1,
cache:!1,success:function(a){Swal.fire("Usuario Actualizado!","El usuario "+b.username+" ha sido actualizado!","success")},error:function(a){Swal.fire("Error!","El usuario "+b.username+" no puedo ser actualizado!","error");console.log(a)}})}});$("#tbl_lista_usuarios").DataTable({responsive:!0});$("#btn_edit").on("click",function(){$("#modal_edit").modal("show")});$("#btn_add").on("click",function(){$("#modal_add").modal("show")})});